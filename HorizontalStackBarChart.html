<!DOCTYPE html>
<meta charset="utf-8" />

<head>
    <script src="./Data/d3DefaultConfig.js"></script>
    <script src="./Data/utils.js"></script>
    <script src="./Data/d3.v4.min.js"></script>
    <script src="./Data/d3-scale-chromatic.v1.min.js"></script>
    <script src="./Data/min/numeral.min.js"></script>
    <link rel="stylesheet" href="Data/general.css" />
    <style>
        body {
            padding: 0;
            margin: 0;
        }

        /* .y-axis .domain {
            display: none;
        } */
        ::-webkit-scrollbar {
            width: 15px;
        }

        #my_dataviz {
            overflow-y: scroll;
            margin-left: 40px;
            height: calc(100vh - 71px);
            /* background-color: red; */
            margin-top: 0px;
        }

        #tooltip {
            font-size: 14px;
            font-family: Arial, Helvetica, sans-serif;
            min-width: fit-content;
            max-width: max-content;
        }

        #xAxisLabelId {
            position: fixed;
            bottom: 10px;
            height: 20px;
            margin-left: 40px;
        }

        #xAxisDiv {
            margin-left: 40px;
            background: transparent;
            /* display: none; */
        }
        #yAxisDiv {
            width: 40px;
            /* background-color: red; */
        }
    </style>
</head>

<body>
    <div id="mainChartWindow" style="display: flex; flex-direction: column">
        <div id="yAxisDiv"></div>
        <div id="my_dataviz"></div>
        <div id="xAxisDiv"></div>
        <div id="xAxisLabelId" style="position: fixed"></div>
    </div>

    <div id="tooltip"></div>

    <div id="legend"></div>

    <script>
        // reference: https://bl.ocks.org/seasmith/b72e6b8be1978eae046e0cff131668b1

        function transformData(
            dataValue,
            dataColumns = {},
            dateFormat,
            dateFormat1
        ) {
            json = {};
            var isKey1Date = false;
            var isKey2Date = false;

            // [Tag: Date Change]
            var { yAxisColumnDetails = [], colorByData = [] } = dataColumns;

            // [Tag: Date Change]
            if (yAxisColumnDetails[0].itemType == "Date") {
                isKey1Date = true;
            }
            // [Tag: Date Change]
            if (colorByData[0].itemType == "Date") {
                isKey2Date = true;
            }

            var uniqueKey2 = [];
            var uniqueKey = [];
            dataValue.forEach((d) => {
                if (isKey1Date) {
                    var key = getDateFormattedData(d[1], dateFormat);
                } else {
                    var key = d[1];
                }

                if (!json[key]) {
                    json[key] = {};
                }
                if (isKey2Date) {
                    var key2 = getDateFormattedData(d[0], dateFormat1);
                } else {
                    var key2 = d[0];
                }
                if (!uniqueKey2.includes(key2)) {
                    uniqueKey2.push(key2);
                }
                if (!uniqueKey.includes(key)) {
                    uniqueKey.push(key);
                }

                var value = d[2];

                if (!json[key][key2]) {
                    json[key][key2] = 0;
                }

                json[key][key2] += +value;
            });

            let response = Object.keys(json).map((key) => {
                return { ...json[key], key };
            });
            if (isKey1Date) {
                var sortedKeys = sortDates(json, dateFormat);
                response = sortedKeys.map((d) => {
                    return { ...json[d], key: d };
                });
            }

            var allKeys = uniqueKey2;
            const yAxisUniqueKeys = uniqueKey;

            return [response, allKeys, yAxisUniqueKeys, data[3]];
        }

        function drawChart(data, plottingConfiguration = {}) {
            window.data = data;
            var keys = data[1];

            // let [xAxisLabel, colorbyLabel, yAxisLabel] = data[2];

            let {
                d3colorPalette = defaultD3Config.d3ColorPalette,
                paddingInner = defaultD3Config.defaultPaddingInner,
                dateFormat = defaultD3Config.dateFormat,
                dateFormat1 = defaultD3Config.dateFormat,
                chartType = defaultD3Config.horizontalChartType,
                toolTip = {},
                legendConfig = defaultD3Config.defaultLegendConfig,
                labelConfig = defaultD3Config.defaultlabelConfig,
                gridConfig = defaultD3Config.defaultGridConfig,
                standardThresholdHeight = defaultD3Config.standardThresholdHeight,
                // font size
                xLabelfontSize = defaultD3Config.fontSize,
                yLabelfontSize = defaultD3Config.fontSize,
                xTickfontSize = defaultD3Config.fontSize,
                yTickfontSize = defaultD3Config.fontSize,
                dataLabelfontSize = defaultD3Config.fontSize,
                // font family
                xLabelfontFamily = defaultD3Config.fontFamily,
                yLabelfontFamily = defaultD3Config.fontFamily,
                xTickfontFamily = defaultD3Config.fontFamily,
                yTickfontFamily = defaultD3Config.fontFamily,
                dataLabelfontFamily = defaultD3Config.fontFamily,
                dataColumns,
                // font color
                xLabelfontColor = defaultD3Config.fontColor,
                yLabelfontColor = defaultD3Config.fontColor,
                xTickfontColor = defaultD3Config.fontColor,
                yTickfontColor = defaultD3Config.fontColor,
                dataLabelColor = defaultD3Config.fontColor,
                // xaxis setting
                xAxisConfig = defaultD3Config.xAxisConfig,
                yAxisConfig = defaultD3Config.yAxisConfig,
            } = plottingConfiguration;
            window.xLabelfontSize = xLabelfontSize;
            window.yLabelfontSize = yLabelfontSize;
            window.xTickfontSize = xTickfontSize;
            window.yTickfontSize = yTickfontSize;
            window.dataLabelfontSize = dataLabelfontSize;

            window.xLabelfontFamily = xLabelfontFamily;
            window.yLabelfontFamily = yLabelfontFamily;
            window.xTickfontFamily = xTickfontFamily;
            window.yTickfontFamily = yTickfontFamily;
            window.dataLabelfontFamily = dataLabelfontFamily;

            window.xLabelfontColor = xLabelfontColor;
            window.yLabelfontColor = yLabelfontColor;
            window.xTickfontColor = xTickfontColor;
            window.yTickfontColor = yTickfontColor;
            window.dataLabelColor = dataLabelColor;

            d3.selectAll("#my_dataviz").html("");
            d3.selectAll("#yAxisDiv").html("");
            d3.select("#legend").html("").style("padding", "");

            if (chartType != constants.chartType.STANDARD) {
                chartType = constants.chartType.FIT_HEIGHT;
                d3.select("#xAxisLabelId").style("bottom", "0px");
            }

            let { legendStatus, legendPosition } = legendConfig;
            let { labelStatus, labelFormat } = labelConfig;
            let { gridStatus } = gridConfig;
            let {
                xlabel,
                xboldLabel,
                xitalicLabel,
                xboldTick,
                xitalicTick,
                xaxisStatus = true,
            } = xAxisConfig;
            let {
                ylabel,
                yboldLabel,
                yitalicLabel,
                yboldTick,
                yitalicTick,
                yaxisStatus = true,
            } = yAxisConfig;
            window.yboldLabel = yboldLabel;
            window.xboldLabel = xboldLabel;
            window.xitalicLabel = xitalicLabel;
            window.yitalicLabel = yitalicLabel;
           if (!xAxisConfig.xlabel && !yAxisConfig.ylabel) {
                [xAxisLabel, yAxisLabel, colorData] = data[3];
                 console.log(data)
            } else {
                [xAxisLabel, yAxisLabel, colorData] = [
                    xAxisConfig.xlabel,
                    yAxisConfig.ylabel,
                    data[3][2],
                ];
            }
            d3Colors = d3colorPalette;
            var [data, keys, yAxisUniqueKeys, labels] = transformData(
                data[0],
                dataColumns,
                dateFormat,
                dateFormat1
            );

            // const { top, right, bottom, left } = constants.chartMargins;
            // var margin = { top: 20, right: 50, bottom: 80, left: 100 };
            var margin = constants.chartMargins;
            var width = window.innerWidth - margin.left - margin.right;
            var height = window.innerHeight - margin.top - margin.bottom + 10;

            var bottomHeight = 0;

            data.forEach(function (d) {
                var y0_positive = 0;
                var y0_negative = 0;

                var mainKey = d.key;
                d.components = keys.map(function (key) {
                    if (d[key] >= 0) {
                        return {
                            key,
                            mainKey,
                            y1: y0_positive,
                            y0: (y0_positive += d[key]),
                        };
                    } else if (d[key] < 0) {
                        return {
                            key,
                            mainKey,
                            y0: y0_negative,
                            y1: (y0_negative += d[key]),
                        };
                    }
                });
            });
            d3.selectAll("#my_dataviz").style("height", "calc(100vh - 50px)");
            d3.selectAll("#my_dataviz").style("margin-top", "0px");
            d3.selectAll("#xAxisLabelId").style('bottom',"10px");

            /*
                  if (chartType == constants.chartType.STANDARD) {
                      height = yAxisUniqueKeys.length * standardThresholdHeight;
                      if (height + margin.top + margin.bottom < window.innerHeight) {
                          console.log("Bottom", height + margin.top + margin.bottom);
                          d3.select("#xAxisDiv").style("top", height + "px");
                      } else {
                          d3.select("#xAxisDiv").style("bottom", "0");
                          d3.select("#xAxisDiv").style("top", null);
                      }
                  }

                  if (chartType == constants.chartType.FIT_HEIGHT) {
                      if (height + margin.top + margin.bottom < window.innerHeight) {
                          d3.select("#xAxisDiv").style(
                              "bottom",
                              window.innerHeight -
                                  (height + margin.top + margin.bottom) +
                                  "px"
                          );
                          d3.select("#xAxisDiv").style("top", null);
                          console.log("test");
                      } else {
                          d3.select("#xAxisDiv").style("top", null);
                      }
                  }

                  */
            //  debugger;

            if (chartType == constants.chartType.STANDARD) {
                console.log(yAxisUniqueKeys.length);
                height = yAxisUniqueKeys.length * standardThresholdHeight;
                if (height + margin.top + margin.bottom < window.innerHeight) {
                    d3.select("#xAxisDiv").style(
                        "top",
                        height + margin.top + "px"
                    );
                    d3.select("#xAxisLabelId").style(
                        "top",
                        height + margin.top + 50 + "px"
                    );
                } else {
                    d3.select("#xAxisDiv").style("bottom", 0);
                    d3.select("#xAxisLabelId").style("bottom", "0px");
                }
            } else {
                d3.select("#xAxisLabelId").style("top", "auto");
            }

            if (height + margin.top + margin.bottom < window.innerHeight) {
                d3.select("#xAxisDiv").style(
                    "bottom",
                    window.innerHeight -
                        (height + margin.top + margin.bottom) +
                        "px"
                );
            } else {
                d3.select("#xAxisDiv").style("bottom", 0);
                d3.select("#xAxisDiv").style("top", null);
            }

            d3.select("#xAxisDiv").style("bottom", "-15px");

            

            toolTip.textColumn1 = toolTip.textColumn1 || (labels && labels[0]);
            toolTip.textColumn2 = toolTip.textColumn2 || (labels && labels[1]);
            toolTip.colorData = toolTip.colorData || (labels && labels[2]);


            const yAxisWidth = document.querySelector("#yAxisDiv").clientWidth;

            // debugger;
            width = width - yAxisWidth;

            // legends height ,width elements
            var legendElement = document.querySelector("#legend");
            var legendHeight = legendElement.offsetHeight;
            var legendWidth = legendElement.offsetWidth;
            // legends code starts
            d3.select("#legend").html("").style("padding", "");
            if (legendStatus) {
                d3.select("#legend").html("");

                d3.select("#legend")
                    .append("p")
                    .html(colorData + "&nbsp;")
                    .style("font-weight", "bold")
                    .style("margin", "auto")
                    .style("position", "sticky");

                d3.select("#legend")
                    .selectAll("div")
                    .data(keys)
                    .enter()
                    .append("div")
                    .html((d, i) => {
                        return (
                            '<div style="width: 15px; height: 15px; margin-top:2px; background: ' +
                            d3Colors[i % d3Colors.length] +
                            ';">  </div>' +
                            "<span style='margin-left: 5px; max-width: 160px'>" +
                            d +
                            "</span>"
                        );
                    })
                    .style("display", "flex")
                    .style("padding", "2px");
            }

            d3.select("#legend").attr("style", null);
            d3.select("#mainChartWindow").attr("style", null);

            // legends code starts
            if (legendStatus) {
                if (
                    legendHeight < document.querySelector("html").offsetHeight
                ) {
                    topPosition = "calc(50vh - " + legendHeight / 2 + "px)";
                } else {
                    topPosition = 0;
                }

                rightPosition = "calc(50vw - " + legendWidth / 2 + "px)";

                //  var widthOld = (document.querySelector("#my_dataviz").clientWidth) ;
                var widthOld = document.querySelector("html").clientWidth - 40;
                var heightOld = document.querySelector("html").clientHeight;

                // legendElement.style.padding = "10px";
                legendElement.style.border = "1px solid black";

                switch (legendPosition) {
                    case "left":
                        // clearStyle();
                        d3.select("#legend")
                            .attr("style", null)
                            .style("top", topPosition)
                            .style("right", "auto")
                            // .style("bottom", "auto")
                            .style("left", "0px")
                            // .style("right", "5px")
                            .style("display", "block")
                            .style("max-height", "100vh")
                            .style("overflow-x", "scroll")
                            .style("border", "none")
                            .style("position", "fixed");
                        d3.selectAll("#legend div span")
                            .style("max-width", "160px")
                            .style("white-space", "nowrap")
                            .style("overflow", "hidden")
                            .style("text-overflow", "ellipsis");

                        var legendWidth = legendElement.offsetWidth;
                        // margin.left += 100;
                        // width -= 100;
                        // d3.select("#my_dataviz svg").attr("width", width + margin.left + margin.right);

                        d3.select("#mainChartWindow").attr("style", null);

                        d3.select("#mainChartWindow").style(
                            "width",
                            widthOld - legendWidth + yAxisWidth + "px"
                        );
                        d3.select("#mainChartWindow").style(
                            "margin-left",
                            legendWidth + "px"
                        );
                        d3.selectAll("#my_dataviz").style("margin-top", "0px");
                        break;
                    case "top":
                        // clearStyle();
                        d3.select("#mainChartWindow").attr("style", null);
                        // margin.top += 50;
                        height -= 30;
                        d3.select("#legend")
                            .attr("style", null)
                            .style("top", "10px")
                            .style("right", rightPosition)
                            .style("bottom", "auto")
                            .style("left", "auto")
                            .style("display", "flex")
                            .style("max-width", "99vw")
                            .style("overflow-x", "scroll")
                            .style("border", "none");
                        d3.selectAll("#legend div span")
                            .style("max-width", "160px")
                            .style("white-space", "nowrap")
                            .style("overflow", "hidden")
                            .style("text-overflow", "ellipsis");

                        // d3.selectAll("#legend div").style(
                        //     "padding",
                        //     "2px 4px"
                        // );
                        d3.selectAll("#my_dataviz").style("margin-top", "30px");

                        d3.selectAll("#my_dataviz").style(
                            "height",
                            "calc(100vh - 60px)"
                        );
                        // debugger;
                        // d3.selectAll("#xAxisDiv").style(
                        //     "bottom",
                        //     "0"
                        // );
                        d3.select("#mainChartWindow").style("margin-left", 0);
                        //   d3.select("#my_dataviz").style(
                        //     "width",
                        //     widthOld + yAxisWidth - 50 + "px"
                        // );
                        break;
                    case "bottom":
                        // clearStyle();
                        height -= 35; // use legend client height
                        // bottomHeight += 50;
                        // margin.bottom += 10;
                        var legendWidth = legendElement.offsetWidth;

                        d3.select("#xAxisLabelId").style("bottom", "20px");
                        d3.select("#mainChartWindow").attr("style", null);

                        // d3.select("#mainChartWindow").style("width", width);
                        //  d3.select("#mainChartWindow").style("height",heightOld-80 );
                        d3.select("#mainChartWindow").style("margin-left", 0);
                        d3.select("#legend")
                            .attr("style", null)
                            .style("top", "auto")
                            .style("right", rightPosition)
                            .style("bottom", "0px")
                            // .style("left", margin.left + "px")
                            .style("display", "flex")
                            .style("max-width", "99vw")
                            .style("overflow-x", "scroll")
                            .style("border", "none");

                        d3.selectAll("#legend div span")
                            .style("max-width", "160px")
                            .style("white-space", "nowrap")
                            .style("overflow", "hidden")
                            .style("text-overflow", "ellipsis");

                        d3.selectAll("#my_dataviz").style("margin-top", "0px");
                        // d3.selectAll("#my_dataviz").style(
                        //     "margin-bottom",
                        //     180+"px"
                        // );
                        d3.selectAll("#my_dataviz").style(
                            "height",
                            "calc(100vh - 60px)"
                        );
                        d3.selectAll("#xAxisDiv").style("bottom", "20px");
                        d3.selectAll("#xAxisLabelId").style("bottom", "50px");

                        break;
                    // For Right Legened
                    case "right":
                    default:
                        // debugger;
                        // clearStyle();
                        var legendWidth = legendElement.offsetWidth;
                        // width -= legendWidth;
                        // d3.select("#my_dataviz").style("width", width + margin.left + margin.right);

                        d3.select("#legend")
                            .attr("style", null)
                            .style("right", "5px")
                            .style("left", "auto")
                            .style("position", "fixed")
                            .style("top", topPosition)
                            .style("max-height", "100vh")
                            .style("overflow-x", "scroll")
                            .style("border", "none")
                            .style("bottom", "auto")
                            .style("display", "block");
                        d3.selectAll("#legend div span")
                            .style("max-width", "160px")
                            .style("white-space", "nowrap")
                            .style("overflow", "hidden")
                            .style("text-overflow", "ellipsis");

                        d3.select("#mainChartWindow").attr("style", null);
                        // d3.select("#mainChartWindow").style(
                        //     "width",
                        //     widthOld + yAxisWidth - legendWidth - 20
                        // )
                        // d3.select("#my_dataviz").style(
                        //     "width",
                        //     widthOld + yAxisWidth - legendWidth -50+"px"
                        // );
                        d3.select("#mainChartWindow").style(
                            "width",
                            widthOld + yAxisWidth - legendWidth - 20 + "px"
                        );

                        d3.select("#mainChartWindow").style("margin-left", 0);
                        d3.selectAll("#my_dataviz").style("margin-top", "0px");
                }
            }

            if (legendPosition == "left" || legendPosition == "right") {
                var legendWidth = legendElement.offsetWidth;
                width -= legendWidth;
            }
            if (legendPosition == "top") {
                var legendHeightTop = 4;
            } else {
                legendHeightTop = 0;
            }
            if (legendPosition == "left") {
                var legendWidthLeft = legendWidth;
            } else {
                legendWidthLeft = 0;
            }

            // legends code ends

            var y = d3
                .scaleBand()
                .domain(
                    data.map(function (d) {
                        return d.key;
                    })
                )
                .range([height, 0])
                .padding(paddingInner);

            var barWidth = y.bandwidth();

            var series = d3.stack().keys(keys).offset(d3.stackOffsetDiverging)(
                data
            );

            var x = d3
                .scaleLinear()
                .domain([d3.min(series, stackMin), d3.max(series, stackMax)])
                .range([0, width])
                .nice();

            var z = d3.scaleOrdinal(d3Colors);

            if (chartType == constants.chartType.STANDARD) {
                // height = dataValues[0].length * standardThresholdHeight;
                if (height + margin.top + margin.bottom < window.innerHeight) {
                    // console.log("Change Position");
                    if (legendPosition == "bottom" || legendStatus == "true") {
                        d3.select("#xAxisDiv").style(
                            "top",
                            height + margin.top + "px"
                        );
                        d3.select("#xAxisLabelId").style(
                            "top",
                            height + margin.top + 50 + "px"
                        );
                    } else {
                        // d3.select("#xAxisDiv").style(
                        //     "top",
                        //     height + margin.top + "px"
                        // );
                        d3.select("#xAxisLabelId").style(
                            "top",
                            height + margin.top + 50 + "px"
                        );
                    }

                    // TODO:x-axis label
                } else {
                    if (legendStatus && legendPosition == "bottom") {
                        d3.select("#xAxisDiv").style("bottom", 50 + "px");
                    } else {
                        d3.select("#xAxisDiv").style("bottom", 0 + "px");
                    }
                }
            }

            window.clearChart && clearChart();
            var svg = d3
                .selectAll("#my_dataviz")
                .append("svg")
                .attr("width", width + margin.left + margin.right - 40)
                .attr("height", height + margin.top + bottomHeight)
                .append("g")
                .attr(
                    "transform",
                    "translate(" + margin.left + "," + margin.top + ")"
                );
            d3.selectAll("#yAxisDiv")
                .append("svg")
                .attr("width", 40)
                .attr("height", window.innerHeight)
                .append("g")
                .attr(
                    "transform",
                    "translate(" + margin.left + "," + (margin.top + 10) + ")"
                );

            xTicks = width / 70;
            // svg
            //     .append("g")
            //     .attr("class", "grid")
            //     .style("stroke-width", "1")
            //     .call(
            //         make_x_gridlines(x).tickSize(height).tickFormat("").ticks(xTicks)
            //     );

            if (gridStatus) {
                svg.append("g")
                    .attr("class", "grid")
                    .style("stroke-width", "1")
                    .call(
                        make_x_gridlines(x)
                            .tickSize(height)
                            .tickFormat("")
                            .ticks(xTicks)
                    );
            } else {
                svg.append("g")
                    .attr("class", "grid")
                    .style("stroke-width", "1")
                    .style("display", "none")
                    .call(
                        make_x_gridlines(x)
                            .tickSize(height)
                            .tickFormat("")
                            .ticks(xTicks)
                    );
            }

            var keysIterator = 0;

            console.log(series);
            var entry = svg
                .append("g")
                .selectAll("g")
                .data(series)
                .enter()
                .append("g")
                .attr("fill", function (d) {
                    this.setAttribute("data-value-x", d.key);
                    return z(d.key);
                });

            entry
                .selectAll("rect")
                .data(function (d, i) {
                    console.log(d, i);
                    return d;
                })
                .enter()
                .append("rect")
                .attr("height", y.bandwidth())
                .attr("class", "bar")
                .attr("y", function (d) {
                    return y(d.data.key);
                })
                .attr("x", function (d, i) {
                    return x(d[0]);
                })
                .attr("width", function (d) {
                    this.setAttribute("data-value-y", d.data.key);
                    this.setAttribute(
                        "data-value-x1",
                        d[1] <= 0 ? d[0] - d[1] : d[1] - d[0]
                    ); // Actual value
                    return x(d[1]) - x(d[0]);
                })
                .on("mouseout", function (d, i) {
                    d3.select("#tooltip").style("display", "none");
                    d3.selectAll(".bar").style("opacity", 1);
                })
                .on("mouseover mousemove", function (d, i) {
                    let xpos1 = d3.mouse(this)[0] + margin.left;
                    let ypos = d3.mouse(this)[1] - 20;

                    var yScroll =
                        document.querySelector("#my_dataviz").scrollTop;
                    ypos -= yScroll;
                    var parentBox = this.parentElement;
                    let xValue = parentBox.getAttribute("data-value-x");
                    let x1Value = this.getAttribute("data-value-x1"); // Actual value
                    let yValue = this.getAttribute("data-value-y");

                    console.log(legendHeightTop);
                    d3.select("#tooltip")
                        .style("left", xpos1 + "px")
                        .style("top", ypos - 36 + legendHeightTop + "px")
                        .style("display", "block")
                        .style("position", "absolute")
                        .html(function () {
                            var textValue = d.y0 - d.y1;
                            if (d.y1 < 0) {
                                textValue = d.y1 - d.y0;
                            }

                            return (
                                "<div class='arrowTooltip'></div>" +
                                "<span style='color:grey;''>" +
                                toolTip.textColumn1 +
                                ":&nbsp;&nbsp;" +
                                "</span>" +
                                "<span style='float: right;'>" +
                                yValue +
                                "</span>" +
                                "<br/> <br/>" +
                                "<span style='color:grey;''>" +
                                toolTip.colorData +
                                ":&nbsp;&nbsp;" +
                                "</span>" +
                                "<span style='float: right;'>" +
                                xValue +
                                "</span>" +
                                "<br/> <br/>" +
                                "<span style='color:grey;''>" +
                                toolTip.textColumn2 +
                                ":" +
                                "</span>" +
                                "<span style='float: right;margin-left: 15px;'>" +
                                (x1Value && Math.round(+x1Value)) +
                                "</span>"
                            );
                        });
                        if (legendPosition == "top") {
                    d3.select("#tooltip").style("top", ypos - 10 + legendHeightTop + "px");
                }
                    if (
                        xpos1 - window.scrollX >
                        document.documentElement.clientWidth -
                            document.querySelector("#tooltip").clientWidth
                    ) {
                        d3.select("#tooltip").style(
                            "left",
                            xpos1 -
                                document.querySelector("#tooltip").clientWidth +
                                25 +
                                legendWidthLeft +
                                "px"
                        );

                        d3.select(".arrowTooltip")
                            //  document.querySelector("#tooltip:before")
                            // .style("height","50px";"width","50px";"background-color","red";")

                            .attr(
                                "style",
                                "border: solid; border-color: white transparent; border-width: 12px 6px 0 6px; content: '';right: -12px; transform: rotate(-90deg)!important;bottom: 22px; position: absolute;"
                            );
                    } else {
                        d3.select("#tooltip").style(
                            "left",
                            xpos1 + 55 + legendWidthLeft + "px"
                        );

                        d3.select(".arrowTooltip").attr(
                            "style",
                            "border: solid; border-color: white transparent; border-width: 12px 6px 0 6px; content: '';left: -12px; transform: rotate(90deg)!important;bottom: 22px; position: absolute;"
                        );
                    }

                    d3.selectAll(".bar").style("opacity", 0.3);
                    d3.select(this).style("opacity", 1);
                });
                

            svg.append("g")
                .attr("class", "y-axis")
                .attr("dy", "2.32em")
                .attr("transform", "translate(0, 0)")
                .call(d3.axisLeft(y).tickSize(0));

            if (labelStatus) {
                entry
                    .selectAll("text.label")
                    .data(function (d) {
                        return d;
                    })
                    .enter()
                    .append("text")
                    .attr("class", "label")
                    .attr("height", y.bandwidth)
                    .attr("class", "bar")

                    .attr("y", function (d) {
                        return y(d.data.key) + y.bandwidth() / 2 + 5;
                    })
                    .text(function (d) {
                        console.log(d);
                        return labelFormatSet(
                            d[1] <= 0 ? d[0] - d[1] : d[1] - d[0],
                            labelFormat
                        );
                    })
                    .attr("x", function (d, i) {
                        return (
                            x(d[0] + x(d[1])) +
                            (x(d[1]) - x(d[0])) / 2 -
                            (d[1] - d[0]).toFixed(2).length * 4
                        );
                    })
                    .attr("width", function (d) {
                        return x(d[1]) - x(d[0]);
                    })
                    .attr("display", function (d) {
                        if (x(d[1]) - x(d[0]) < 100) {
                            return "none";
                        } else {
                            return "";
                        }
                    })
                    .attr("font-family", dataLabelfontFamily)
                    .attr("font-size", dataLabelfontSize)
                    // .attr("fill", "red");
                    .attr("fill", dataLabelColor);
            }

            var xAxis = d3
                .axisBottom(x)
                .tickSize(0)
                .ticks(xTicks)
                .tickFormat(d3.format(".2s"));

            d3.select("#xAxisDiv")
                .append("svg")
                .attr("height", "72")
                .attr("width", width + margin.left + margin.right)
                .append("g") //add group to leave margin for axis
                .attr(
                    "transform",
                    "translate(" + margin.left + ",0)"
                    // "translate(0,0)"
                )
                .append("g")
                .attr("class", "x-axis")
                .call(xAxis);

            d3.selectAll(".y-axis g text")
                .attr("font-size", yTickfontSize)
                .attr("font-family", yTickfontFamily)
                .attr("font-weight", yboldTick ? "bold" : "regular")
                .attr("font-style", yitalicTick ? "italic" : "regular")
                // .attr("fill", "red");
                .attr("fill", yTickfontColor);

            d3.selectAll(".x-axis g text")
                .attr("font-size", xTickfontSize)
                .attr("font-family", xTickfontFamily)
                .attr("font-weight", xboldTick ? "bold" : "regular")
                .attr("font-style", xitalicTick ? "italic" : "regular")
                .attr("fill", xTickfontColor)
                // .attr("fill", "red");
                .attr("y", 8);

            if (xaxisStatus) {
                d3.selectAll("g .x-axis").attr("style", "display: block");
            } else {
                d3.selectAll("g .x-axis").attr("style", "display: none");
            }
            if (yaxisStatus) {
                d3.selectAll("g .y-axis").attr("style", "display: block");
            } else {
                d3.selectAll("g .y-axis").attr("style", "display: none");
            }

            if (chartType == constants.chartType.FIT_HEIGHT) {
                removeAxisTicks("yAxis", data[0]);
            }

            a = document.querySelectorAll(".y-axis text");
            for (var i = 0; i < a.length; i++) {
                if (a[i] && a[i].innerHTML) {
                    var singleCharacterLength =
                        a[i].getBBox().width / a[i].innerHTML.length;

                    var maxWidth =
                        document.querySelector(".y-axis").getBBox().width > 64
                            ? 64
                            : document.querySelector(".y-axis").getBBox().width;

                    var numOfCharacters = maxWidth / singleCharacterLength;

                    if (a[i].innerHTML.length > numOfCharacters) {
                        a[i].innerHTML =
                            a[i].innerHTML.substr(0, numOfCharacters - 3) +
                            "...";
                    }
                }
            }

            setLabel(xAxisLabel, "y_label", d3.select("svg"), false);
            setLabel(
                yAxisLabel,
                "x_label",
                d3
                    .select("#xAxisLabelId")
                    .append("svg")
                    .attr("width", window.innerWidth, "height", 150),
                50
            );
            setXAxisTicksDistance();

            function stackMin(series) {
                return d3.min(series, function (d) {
                    return d[0];
                });
            }

            function stackMax(series) {
                return d3.max(series, function (d) {
                    return d[1];
                });
            }

            function make_x_gridlines(x) {
                return d3.axisBottom(x);
            }
            function make_y_gridlines(y) {
                return d3.axisLeft(y).ticks(xTicks);
            }
        }
        // prettier-ignore
   
    </script>
</body>
